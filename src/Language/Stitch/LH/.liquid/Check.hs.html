<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>src/Language/Stitch/LH/Check.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>  1: </span><a class=annot href="#"><span class=annottext>GHC.Types.Module</span><span class='hs-comment'>{-# LANGUAGE LambdaCase #-}</span></a>
<span class=hs-linenum>  2: </span><span class='hs-comment'>{-# OPTIONS_GHC -fplugin=LiquidHaskell -Wno-incomplete-patterns #-}</span>
<span class=hs-linenum>  3: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--exact-data-cons"</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>  4: </span><span class='hs-comment'>-- ple is necessary to reason about the evaluation of checkBindings</span>
<span class=hs-linenum>  5: </span><span class='hs-keyword'>{-@</span> <span class='hs-conid'>LIQUID</span> <span class='hs-str'>"--ple"</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>  6: </span>
<span class=hs-linenum>  7: </span><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<span class=hs-linenum>  8: </span><span class='hs-comment'>-- |</span>
<span class=hs-linenum>  9: </span><span class='hs-comment'>-- Module      :  Language.Stitch.LH.Check</span>
<span class=hs-linenum> 10: </span><span class='hs-comment'>-- Copyright   :  (C) 2015 Richard Eisenberg</span>
<span class=hs-linenum> 11: </span><span class='hs-comment'>--                (C) 2021 Facundo Dom√≠nguez</span>
<span class=hs-linenum> 12: </span><span class='hs-comment'>-- License     :  BSD-style (see LICENSE)</span>
<span class=hs-linenum> 13: </span><span class='hs-comment'>-- Stability   :  experimental</span>
<span class=hs-linenum> 14: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 15: </span><span class='hs-comment'>-- The stitch typechecker.</span>
<span class=hs-linenum> 16: </span><span class='hs-comment'>--</span>
<span class=hs-linenum> 17: </span><span class='hs-comment'>----------------------------------------------------------------------------</span>
<span class=hs-linenum> 18: </span>
<span class=hs-linenum> 19: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>Language.Stitch.LH.Check</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 20: </span>
<span class=hs-linenum> 21: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 22: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<span class=hs-linenum> 23: </span><span class='hs-comment'>-- XXX: If we don't import Data.Set, LH fails with: Unbound symbol Set_mem</span>
<span class=hs-linenum> 24: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data.Set</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Set</span>
<span class=hs-linenum> 25: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Liquid.ProofCombinators</span>
<span class=hs-linenum> 26: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Data.List</span> <span class='hs-layout'>(</span><span class='hs-conid'>List</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 27: </span><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Language.Stitch.LH.Data.List</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>List</span>
<span class=hs-linenum> 28: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Data.Nat</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Nat</span>
<span class=hs-linenum> 29: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Type</span>
<span class=hs-linenum> 30: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Op</span>
<span class=hs-linenum> 31: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Pretty</span>
<span class=hs-linenum> 32: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Stitch.LH.Unchecked</span>
<span class=hs-linenum> 33: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Text.PrettyPrint.ANSI.Leijen</span>
<span class=hs-linenum> 34: </span>
<span class=hs-linenum> 35: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>predicate</span> <span class='hs-conid'>WellTyped</span> <span class='hs-conid'>E</span> <span class='hs-conid'>CTX</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkBindings</span> <span class='hs-conid'>CTX</span> <span class='hs-conid'>E</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>numFreeVarsExp</span> <span class='hs-conid'>E</span> <span class='hs-varop'>&lt;=</span> <span class='hs-conid'>List.length</span> <span class='hs-conid'>CTX</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 36: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>WellTypedExp</span> <span class='hs-conid'>CTX</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WellTyped</span> <span class='hs-varid'>e</span> <span class='hs-conid'>CTX</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 37: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>FunExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFunTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>exprType</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 38: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ExpT</span> <span class='hs-conid'>T</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>T</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>exprType</span> <span class='hs-varid'>e</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 39: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum> 40: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>Exp</span>
<span class=hs-linenum> 41: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-layout'>{</span> <span class='hs-varid'>varTyp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ty</span> <span class='hs-layout'>,</span> <span class='hs-varid'>varNat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Nat</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 42: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Lam</span> <span class='hs-layout'>{</span> <span class='hs-varid'>lamTyp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ty</span> <span class='hs-layout'>,</span> <span class='hs-varid'>lamBdy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 43: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>App</span> <span class='hs-layout'>{</span> <span class='hs-varid'>appFun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>appArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 44: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Let</span> <span class='hs-layout'>{</span> <span class='hs-varid'>letExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>letBdy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 45: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Arith</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ariLhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExpT</span> <span class='hs-conid'>TInt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ariOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ArithOp</span><span class='hs-layout'>,</span> <span class='hs-varid'>ariRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExpT</span> <span class='hs-conid'>TInt</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 46: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Cond</span> <span class='hs-layout'>{</span> <span class='hs-varid'>conPrc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExpT</span> <span class='hs-conid'>TBool</span><span class='hs-layout'>,</span> <span class='hs-varid'>conCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>conAnt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExpT</span> <span class='hs-layout'>(</span><span class='hs-varid'>exprType</span> <span class='hs-varid'>conCon</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 47: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Fix</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fixFun</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>FunExp</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>funArgTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>exprType</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>funResTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>exprType</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 48: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IntE</span> <span class='hs-layout'>{</span> <span class='hs-varid'>intVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 49: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BoolE</span> <span class='hs-layout'>{</span> <span class='hs-varid'>bolVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 50: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 51: </span>
<span class=hs-linenum> 52: </span><span class='hs-comment'>-- | Checked expression</span>
<span class=hs-linenum> 53: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>Exp</span>
<span class=hs-linenum> 54: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-layout'>{</span> <span class='hs-varid'>varTyp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ty</span> <span class='hs-layout'>,</span> <span class='hs-varid'>varNat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Nat</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 55: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Lam</span> <span class='hs-layout'>{</span> <span class='hs-varid'>lamTyp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ty</span> <span class='hs-layout'>,</span> <span class='hs-varid'>lamBdy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 56: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>App</span> <span class='hs-layout'>{</span> <span class='hs-varid'>appFun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>appArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 57: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Let</span> <span class='hs-layout'>{</span> <span class='hs-varid'>letExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>letBdy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 58: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Arith</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ariLhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>ariOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ArithOp</span><span class='hs-layout'>,</span> <span class='hs-varid'>ariRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 59: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Cond</span> <span class='hs-layout'>{</span> <span class='hs-varid'>conPrc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>conCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>conAnt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 60: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Fix</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fixFun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 61: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IntE</span> <span class='hs-layout'>{</span> <span class='hs-varid'>intVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 62: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BoolE</span> <span class='hs-layout'>{</span> <span class='hs-varid'>bolVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-layout'>}</span>
<span class=hs-linenum> 63: </span>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Show</span>
<span class=hs-linenum> 64: </span>
<span class=hs-linenum> 65: </span><span class='hs-comment'>-- An expression paired with the bound for the valid</span>
<span class=hs-linenum> 66: </span><span class='hs-comment'>-- variable indices</span>
<span class=hs-linenum> 67: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>ScopedExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ScopedExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NumVarsInScope</span><span class='hs-layout'>)</span> <span class='hs-layout'>{</span><span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>numFreeVarsExp</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 68: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>ScopedExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ScopedExp</span> <span class='hs-conid'>NumVarsInScope</span> <span class='hs-conid'>Exp</span>
<span class=hs-linenum> 69: </span>
<span class=hs-linenum> 70: </span><span class='hs-keyword'>instance</span> <a class=annot href="#"><span class=annottext>(Text.PrettyPrint.ANSI.Leijen.Internal.Pretty Language.Stitch.LH.Check.ScopedExp)</span><span class='hs-conid'>Pretty</span></a> <span class='hs-conid'>ScopedExp</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum> 71: </span>  <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.ScopedExp -&gt; Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>pretty</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>ScopedExp</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : (Text.PrettyPrint.ANSI.Leijen.Internal.Pretty Language.Stitch.LH.Unchecked.ScopedUExp) | v == $fPrettyScopedUExp}</span><span class='hs-varid'>pretty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | n v == n}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == n}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &lt;= n
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 72: </span>
<span class=hs-linenum> 73: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>uncheckExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>e</span><span class='hs-conop'>:</span><span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{ uexp:</span><span class='hs-conid'>UExp</span> <span class='hs-keyword'>| numFreeVarsExp e = numFreeVars uexp }</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 74: </span><span class='hs-definition'>uncheckExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UExp</span>
<span class=hs-linenum> 75: </span><a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {uexp : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp x1 == numFreeVars uexp}</span><span class='hs-definition'>uncheckExp</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<span class=hs-linenum> 76: </span>  <span class='hs-conid'>Var</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:{v : GHC.Types.Int | v &gt;= 0} -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UVar##lqdc##$select v == x1
                                                                            &amp;&amp; numFreeVars v == x1 + 1
                                                                            &amp;&amp; v == UVar x1}</span><span class='hs-conid'>UVar</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a>
<span class=hs-linenum> 77: </span>  <span class='hs-conid'>Lam</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Type.Ty -&gt; x2:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | ULam##lqdc##$select v == x2
                                                                                                                  &amp;&amp; ULam##lqdc##$select v == x1
                                                                                                                  &amp;&amp; numFreeVars v == (if 0 &gt; numFreeVars x2 - 1 then 0 else numFreeVars x2 - 1)
                                                                                                                  &amp;&amp; v == ULam x1 x2}</span><span class='hs-conid'>ULam</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 78: </span>  <span class='hs-conid'>App</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Unchecked.UExp -&gt; x2:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UApp##lqdc##$select v == x2
                                                                                                                         &amp;&amp; UApp##lqdc##$select v == x1
                                                                                                                         &amp;&amp; numFreeVars v == (if numFreeVars x1 &gt; numFreeVars x2 then numFreeVars x1 else numFreeVars x2)
                                                                                                                         &amp;&amp; v == UApp x1 x2}</span><span class='hs-conid'>UApp</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e1 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e2 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 79: </span>  <span class='hs-conid'>Let</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Unchecked.UExp -&gt; x2:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | ULet##lqdc##$select v == x2
                                                                                                                         &amp;&amp; ULet##lqdc##$select v == x1
                                                                                                                         &amp;&amp; numFreeVars v == (if numFreeVars x1 &gt; (if 0 &gt; numFreeVars x2 - 1 then 0 else numFreeVars x2 - 1) then numFreeVars x1 else (if 0 &gt; numFreeVars x2 - 1 then 0 else numFreeVars x2 - 1))
                                                                                                                         &amp;&amp; v == ULet x1 x2}</span><span class='hs-conid'>ULet</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e1 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e2 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 80: </span>  <span class='hs-conid'>Arith</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Unchecked.UExp -&gt; x2:Language.Stitch.LH.Op.ArithOp -&gt; x3:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UArith##lqdc##$select v == x3
                                                                                                                                                             &amp;&amp; UArith##lqdc##$select v == x2
                                                                                                                                                             &amp;&amp; UArith##lqdc##$select v == x1
                                                                                                                                                             &amp;&amp; numFreeVars v == (if numFreeVars x1 &gt; numFreeVars x3 then numFreeVars x1 else numFreeVars x3)
                                                                                                                                                             &amp;&amp; v == UArith x1 x2 x3}</span><span class='hs-conid'>UArith</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e1 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e2 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 81: </span>  <span class='hs-conid'>Cond</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Unchecked.UExp -&gt; x2:Language.Stitch.LH.Unchecked.UExp -&gt; x3:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UCond##lqdc##$select v == x3
                                                                                                                                                                 &amp;&amp; UCond##lqdc##$select v == x2
                                                                                                                                                                 &amp;&amp; UCond##lqdc##$select v == x1
                                                                                                                                                                 &amp;&amp; numFreeVars v == (if (if numFreeVars x1 &gt; numFreeVars x2 then numFreeVars x1 else numFreeVars x2) &gt; numFreeVars x3 then (if numFreeVars x1 &gt; numFreeVars x2 then numFreeVars x1 else numFreeVars x2) else numFreeVars x3)
                                                                                                                                                                 &amp;&amp; v == UCond x1 x2 x3}</span><span class='hs-conid'>UCond</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e1 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TBool == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e2 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e3 == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | exprType e2 == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 82: </span>  <span class='hs-conid'>Fix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Unchecked.UExp -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UFix##lqdc##$select v == x1
                                                                                 &amp;&amp; numFreeVars v == numFreeVars x1
                                                                                 &amp;&amp; v == UFix x1}</span><span class='hs-conid'>UFix</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVarsExp e == numFreeVars v}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>uncheckExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | isFunTy (exprType v)
                                    &amp;&amp; funArgTy (exprType v) == funResTy (exprType v)
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 83: </span>  <span class='hs-conid'>IntE</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:GHC.Types.Int -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UIntE##lqdc##$select v == x1
                                                             &amp;&amp; numFreeVars v == 0
                                                             &amp;&amp; v == UIntE x1}</span><span class='hs-conid'>UIntE</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == i}</span><span class='hs-varid'>i</span></a>
<span class=hs-linenum> 84: </span>  <span class='hs-conid'>BoolE</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:GHC.Types.Bool -&gt; {v : Language.Stitch.LH.Unchecked.UExp | UBoolE##lqdc##$select v == x1
                                                              &amp;&amp; numFreeVars v == 0
                                                              &amp;&amp; v == UBoolE x1}</span><span class='hs-conid'>UBoolE</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == b}</span><span class='hs-varid'>b</span></a>
<span class=hs-linenum> 85: </span>
<span class=hs-linenum> 86: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>exprType</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 87: </span><span class='hs-definition'>exprType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span>
<span class=hs-linenum> 88: </span><a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {VV : Language.Stitch.LH.Type.Ty | VV == exprType x1}</span><span class='hs-definition'>exprType</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a>
<span class=hs-linenum> 89: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lam</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Type.Ty -&gt; x2:Language.Stitch.LH.Type.Ty -&gt; {v : Language.Stitch.LH.Type.Ty | funResTy v == x2
                                                                                                    &amp;&amp; funArgTy v == x1
                                                                                                    &amp;&amp; (isFunTy v &lt;=&gt; true)
                                                                                                    &amp;&amp; v == TFun x1 x2}</span><span class='hs-conid'>TFun</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == exprType e}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>exprType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 90: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>App</span> <span class='hs-varid'>e1</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Type.Ty -&gt; {v : Language.Stitch.LH.Type.Ty | v == funResTy x1}</span><span class='hs-varid'>funResTy</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == exprType e1}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>exprType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 91: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Let</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {VV : Language.Stitch.LH.Type.Ty | VV == exprType x1}</span><span class='hs-varid'>exprType</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum> 92: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Arith</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Op.ArithOp -&gt; {v : Language.Stitch.LH.Type.Ty | v == arithType x1}</span><span class='hs-varid'>arithType</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a>
<span class=hs-linenum> 93: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cond</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {VV : Language.Stitch.LH.Type.Ty | VV == exprType x1}</span><span class='hs-varid'>exprType</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum> 94: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fix</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Type.Ty -&gt; {v : Language.Stitch.LH.Type.Ty | v == funResTy x1}</span><span class='hs-varid'>funResTy</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == exprType e}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>exprType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | isFunTy (exprType v)
                                    &amp;&amp; funArgTy (exprType v) == funResTy (exprType v)
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum> 95: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>IntE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a>
<span class=hs-linenum> 96: </span><span class='hs-definition'>exprType</span> <span class='hs-layout'>(</span><span class='hs-conid'>BoolE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TBool}</span><span class='hs-conid'>TBool</span></a>
<span class=hs-linenum> 97: </span>
<span class=hs-linenum> 98: </span><span class='hs-comment'>-- | Check that all occurrences of a variable have the given type</span>
<span class=hs-linenum> 99: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>checkBindings</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>100: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>101: </span><span class='hs-definition'>checkBindings</span>
<span class=hs-linenum>102: </span>  <span class='hs-keyglyph'>::</span> <span class='hs-varid'>ctx</span> <span class='hs-conop'>:</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Ty</span>
<span class=hs-linenum>103: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{ e :</span> <span class='hs-conid'>Exp</span> <span class='hs-keyword'>| numFreeVarsExp e &lt;= List.length ctx }</span>
<span class=hs-linenum>104: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>105: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>106: </span><span class='hs-definition'>checkBindings</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>107: </span><a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; {e : Language.Stitch.LH.Check.Exp | numFreeVarsExp e &lt;= length x1} -&gt; GHC.Types.Bool</span><span class='hs-definition'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>[Language.Stitch.LH.Type.Ty]</span><span class='hs-varid'>ctx</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>vty</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == elemAt i ctx}</span><span class='hs-conid'>List.elemAt</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == vty}</span><span class='hs-varid'>vty</span></a>
<span class=hs-linenum>108: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lam</span> <span class='hs-varid'>t</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; {e : Language.Stitch.LH.Check.Exp | numFreeVarsExp e &lt;= length x1} -&gt; GHC.Types.Bool</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx
                                    &amp;&amp; head v == t
                                    &amp;&amp; lqdc##$select v == ctx
                                    &amp;&amp; lqdc##$select v == t
                                    &amp;&amp; len v == 1 + len ctx
                                    &amp;&amp; length v == 1 + length ctx
                                    &amp;&amp; listElts v == Set_cup (Set_sng t) (listElts ctx)
                                    &amp;&amp; v == : t ctx}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == t}</span><span class='hs-varid'>t</span></a><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a>
<span class=hs-linenum>109: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>App</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e1}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>&amp;&amp;</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e2}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>110: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>Let</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e1}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>&amp;&amp;</span> <a class=annot href="#"><span class=annottext>GHC.Types.Bool</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx
                                    &amp;&amp; lqdc##$select v == ctx
                                    &amp;&amp; len v == 1 + len ctx
                                    &amp;&amp; length v == 1 + length ctx}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == exprType e1}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>exprType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>111: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>Arith</span> <span class='hs-varid'>e1</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e1}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>&amp;&amp;</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e2}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>112: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cond</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e1}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TBool == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>&amp;&amp;</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e2}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <span class='hs-varop'>&amp;&amp;</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == checkBindings ctx e3}</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | exprType e2 == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a>
<span class=hs-linenum>113: </span><span class='hs-definition'>checkBindings</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fix</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; {e : Language.Stitch.LH.Check.Exp | numFreeVarsExp e &lt;= length x1} -&gt; GHC.Types.Bool</span><span class='hs-varid'>checkBindings</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | isFunTy (exprType v)
                                    &amp;&amp; funArgTy (exprType v) == funResTy (exprType v)
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a>
<span class=hs-linenum>114: </span><span class='hs-definition'>checkBindings</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>IntE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v
                      &amp;&amp; v == True}</span><span class='hs-conid'>True</span></a>
<span class=hs-linenum>115: </span><span class='hs-definition'>checkBindings</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>BoolE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v
                      &amp;&amp; v == True}</span><span class='hs-conid'>True</span></a>
<span class=hs-linenum>116: </span>
<span class=hs-linenum>117: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>rewriteWith</span> <span class='hs-varid'>aClosedExpIsValidInAnyContext</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>List.appendLength</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>118: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>119: </span><span class='hs-definition'>aClosedExpIsValidInAnyContext</span>
<span class=hs-linenum>120: </span>  <span class='hs-keyglyph'>::</span> <span class='hs-varid'>ctx0</span> <span class='hs-conop'>:</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Ty</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>121: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ctx1</span> <span class='hs-conop'>:</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Ty</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>122: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>Exp</span>
<span class=hs-linenum>123: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{ WellTyped e ctx0 &lt;=&gt;
       WellTyped e (List.append ctx0 ctx1) &amp;&amp; numFreeVarsExp e &lt;= List.length ctx0
     }</span>
<span class=hs-linenum>126: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>127: </span><span class='hs-definition'>aClosedExpIsValidInAnyContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Ty</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Ty</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span>
<span class=hs-linenum>128: </span><a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; x2:[Language.Stitch.LH.Type.Ty] -&gt; x3:Language.Stitch.LH.Check.Exp -&gt; {VV : () | checkBindings x1 x3
                                                                                                                    &amp;&amp; numFreeVarsExp x3 &lt;= length x1 &lt;=&gt; (checkBindings (append x1 x2) x3
                                                                                                                                                           &amp;&amp; numFreeVarsExp x3 &lt;= length (append x1 x2))
                                                                                                                                                          &amp;&amp; numFreeVarsExp x3 &lt;= length x1}</span><span class='hs-definition'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>[Language.Stitch.LH.Type.Ty]</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>[Language.Stitch.LH.Type.Ty]</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>e</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>129: </span>  <span class='hs-conid'>Var</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>130: </span>    <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a> <span class='hs-varop'>&lt;</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx0
                     &amp;&amp; v &gt;= 0}</span><span class='hs-conid'>List.length</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <span class='hs-keyword'>then</span> <a class=annot href="#"><span class=annottext>{VV : forall a .
      x1:{v : GHC.Types.Int | v &gt;= 0} -&gt; x2:{v : [a] | x1 &lt; length v} -&gt; x3:[a] -&gt; {v : () | elemAt x1 (append x2 x3) == elemAt x1 x2} | VV == elemAtThroughAppend}</span><span class='hs-conid'>List.elemAtThroughAppend</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a>
<span class=hs-linenum>131: </span>    <span class='hs-keyword'>else</span> <a class=annot href="#"><span class=annottext>{v : () | v == trivial}</span><span class='hs-varid'>trivial</span></a>
<span class=hs-linenum>132: </span>  <span class='hs-conid'>Lam</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>133: </span>    <a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; x2:[Language.Stitch.LH.Type.Ty] -&gt; x3:Language.Stitch.LH.Check.Exp -&gt; {VV : () | checkBindings x1 x3
                                                                                                                    &amp;&amp; numFreeVarsExp x3 &lt;= length x1 &lt;=&gt; (checkBindings (append x1 x2) x3
                                                                                                                                                           &amp;&amp; numFreeVarsExp x3 &lt;= length (append x1 x2))
                                                                                                                                                          &amp;&amp; numFreeVarsExp x3 &lt;= length x1}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx0
                                    &amp;&amp; head v == ty
                                    &amp;&amp; lqdc##$select v == ctx0
                                    &amp;&amp; lqdc##$select v == ty
                                    &amp;&amp; len v == 1 + len ctx0
                                    &amp;&amp; length v == 1 + length ctx0
                                    &amp;&amp; listElts v == Set_cup (Set_sng ty) (listElts ctx0)
                                    &amp;&amp; v == : ty ctx0}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == body}</span><span class='hs-varid'>body</span></a>
<span class=hs-linenum>134: </span>  <span class='hs-conid'>App</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>135: </span>    <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e1
          &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e1
                                                   &amp;&amp; numFreeVarsExp e1 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e2
          &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e2
                                                   &amp;&amp; numFreeVarsExp e2 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>136: </span>  <span class='hs-conid'>Let</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>137: </span>    <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e1
          &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e1
                                                   &amp;&amp; numFreeVarsExp e1 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>()</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx0
                                    &amp;&amp; lqdc##$select v == ctx0
                                    &amp;&amp; len v == 1 + len ctx0
                                    &amp;&amp; length v == 1 + length ctx0}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == exprType e1}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>exprType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>138: </span>  <span class='hs-conid'>Arith</span> <span class='hs-varid'>e1</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>139: </span>    <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e1
          &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e1
                                                   &amp;&amp; numFreeVarsExp e1 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e2
          &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e2
                                                   &amp;&amp; numFreeVarsExp e2 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>140: </span>  <span class='hs-conid'>Cond</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>141: </span>    <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e1
          &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e1
                                                   &amp;&amp; numFreeVarsExp e1 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e1 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TBool == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a>
<span class=hs-linenum>142: </span>      <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e2
          &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e2
                                                   &amp;&amp; numFreeVarsExp e2 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e2 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a>
<span class=hs-linenum>143: </span>      <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>{v : () | checkBindings ctx0 e3
          &amp;&amp; numFreeVarsExp e3 &lt;= length ctx0 &lt;=&gt; (checkBindings (append ctx0 ctx1) e3
                                                   &amp;&amp; numFreeVarsExp e3 &lt;= length (append ctx0 ctx1))
                                                  &amp;&amp; numFreeVarsExp e3 &lt;= length ctx0}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | exprType e2 == exprType v
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a>
<span class=hs-linenum>144: </span>  <span class='hs-conid'>Fix</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>145: </span>    <a class=annot href="#"><span class=annottext>x1:[Language.Stitch.LH.Type.Ty] -&gt; x2:[Language.Stitch.LH.Type.Ty] -&gt; x3:Language.Stitch.LH.Check.Exp -&gt; {VV : () | checkBindings x1 x3
                                                                                                                    &amp;&amp; numFreeVarsExp x3 &lt;= length x1 &lt;=&gt; (checkBindings (append x1 x2) x3
                                                                                                                                                           &amp;&amp; numFreeVarsExp x3 &lt;= length (append x1 x2))
                                                                                                                                                          &amp;&amp; numFreeVarsExp x3 &lt;= length x1}</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx0}</span><span class='hs-varid'>ctx0</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx1}</span><span class='hs-varid'>ctx1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | isFunTy (exprType v)
                                    &amp;&amp; funArgTy (exprType v) == funResTy (exprType v)
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == body}</span><span class='hs-varid'>body</span></a>
<span class=hs-linenum>146: </span>  <span class='hs-conid'>IntE</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{v : () | v == trivial}</span><span class='hs-varid'>trivial</span></a>
<span class=hs-linenum>147: </span>  <span class='hs-conid'>BoolE</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{v : () | v == trivial}</span><span class='hs-varid'>trivial</span></a>
<span class=hs-linenum>148: </span>
<span class=hs-linenum>149: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>numFreeVarsExp</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>150: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>151: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nat</span>
<span class=hs-linenum>152: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>153: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nat</span>
<span class=hs-linenum>154: </span><a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {VV : GHC.Types.Int | VV == numFreeVarsExp x1
                                                         &amp;&amp; VV &gt;= 0}</span><span class='hs-definition'>numFreeVarsExp</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v' : GHC.Types.Int | v' &gt;= 0
                      &amp;&amp; v' == v}</span><span class='hs-varid'>v</span></a> <span class='hs-varop'>+</span> <a class=annot href="#"><span class=annottext>GHC.Types.Int</span><span class='hs-num'>1</span></a>
<span class=hs-linenum>155: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lam</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:GHC.Types.Int -&gt; x2:GHC.Types.Int -&gt; {v : GHC.Types.Int | v == (if 0 &gt; x1 - x2 then 0 else x1 - x2)}</span><span class='hs-conid'>Nat.minus</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp body
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == body}</span><span class='hs-varid'>body</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>GHC.Types.Int</span><span class='hs-num'>1</span></a>
<span class=hs-linenum>156: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>App</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : (GHC.Classes.Ord GHC.Types.Int) | v == $fOrdInt}</span><span class='hs-conid'>Nat.max</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e1
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e2
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>157: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Let</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>158: </span>    <a class=annot href="#"><span class=annottext>{v : (GHC.Classes.Ord GHC.Types.Int) | v == $fOrdInt}</span><span class='hs-conid'>Nat.max</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e1
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>GHC.Types.Int</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Nat.minus</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e2
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>GHC.Types.Int</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>159: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Arith</span> <span class='hs-varid'>e1</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : (GHC.Classes.Ord GHC.Types.Int) | v == $fOrdInt}</span><span class='hs-conid'>Nat.max</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e1
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e2
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TInt == exprType v
                                    &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>160: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cond</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>161: </span>    <a class=annot href="#"><span class=annottext>{v : (GHC.Classes.Ord GHC.Types.Int) | v == $fOrdInt}</span><span class='hs-conid'>Nat.max</span></a> <a class=annot href="#"><span class=annottext>GHC.Types.Int</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Nat.max</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e1
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | TBool == exprType v
                                    &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e2
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == numFreeVarsExp e3
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>numFreeVarsExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | exprType e2 == exprType v
                                    &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>162: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fix</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.Exp -&gt; {VV : GHC.Types.Int | VV == numFreeVarsExp x1
                                                         &amp;&amp; VV &gt;= 0}</span><span class='hs-varid'>numFreeVarsExp</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | isFunTy (exprType v)
                                    &amp;&amp; funArgTy (exprType v) == funResTy (exprType v)
                                    &amp;&amp; v == body}</span><span class='hs-varid'>body</span></a>
<span class=hs-linenum>163: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>IntE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Prim.Int# | v == 0}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>164: </span><span class='hs-definition'>numFreeVarsExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>BoolE</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : GHC.Prim.Int# | v == 0}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>165: </span>
<span class=hs-linenum>166: </span><span class='hs-comment'>-- CHALLENGE: if @check g u (const . Right) == Right e@ enhance the</span>
<span class=hs-linenum>167: </span><span class='hs-comment'>-- specification to say that @uncheckExp e == expandGlobals u@.</span>
<span class=hs-linenum>168: </span>
<span class=hs-linenum>169: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>170: </span><span class='hs-definition'>check</span>
<span class=hs-linenum>171: </span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Globals</span>
<span class=hs-linenum>172: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ClosedUExp</span>
<span class=hs-linenum>173: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-conid'>WellTypedExp</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{ t:</span> <span class='hs-conid'>Ty</span> <span class='hs-keyword'>| exprType e = t }</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<span class=hs-linenum>174: </span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>175: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>176: </span><span class='hs-definition'>check</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Globals</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>177: </span><a class=annot href="#"><span class=annottext>forall a .
Language.Stitch.LH.Check.Globals -&gt; {VV : Language.Stitch.LH.Unchecked.UExp | numFreeVars VV == 0} -&gt; (x4:{VV : Language.Stitch.LH.Check.Exp | checkBindings [] VV
                                                                                                                                               &amp;&amp; numFreeVarsExp VV &lt;= length []} -&gt; {t : Language.Stitch.LH.Type.Ty | exprType x4 == t} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)) -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-definition'>check</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Globals</span><span class='hs-varid'>globals</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v == 0
                                    &amp;&amp; length v == 0
                                    &amp;&amp; Set_emp (listElts v)
                                    &amp;&amp; v == []}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV : forall a &lt;p :: a a -&gt; Bool&gt;.
      {v : [a]&lt;\x3 VV -&gt; {VV : a&lt;p x3&gt; | true}&gt; | len v == 0
                                                  &amp;&amp; length v == 0
                                                  &amp;&amp; Set_emp (listElts v)
                                                  &amp;&amp; v == []} | VV == []}</span><span class='hs-conid'>[]</span></a>
<span class=hs-linenum>178: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>179: </span>    <span class='hs-keyword'>{-@</span>
<span class=hs-linenum>180: </span>      <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>ts</span> <span class='hs-conop'>:</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Ty</span><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>181: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarsSmallerThan</span> <span class='hs-layout'>(</span><span class='hs-conid'>List.length</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span>
<span class=hs-linenum>182: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span> <span class='hs-conop'>:</span> <span class='hs-conid'>WellTypedExp</span> <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{ t:</span> <span class='hs-conid'>Ty</span> <span class='hs-keyword'>| exprType e1 = t }</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<span class=hs-linenum>183: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>184: </span>    <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>185: </span>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>List</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>TyError</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>186: </span>    <a class=annot href="#"><span class=annottext>forall a .
x1:[Language.Stitch.LH.Type.Ty] -&gt; {VV : Language.Stitch.LH.Unchecked.UExp | numFreeVars VV &lt;= length x1} -&gt; (x4:{VV : Language.Stitch.LH.Check.Exp | checkBindings x1 VV
                                                                                                                                                      &amp;&amp; numFreeVarsExp VV &lt;= length x1} -&gt; {t : Language.Stitch.LH.Type.Ty | exprType x4 == t} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)) -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>[Language.Stitch.LH.Type.Ty]</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{VV : Language.Stitch.LH.Unchecked.UExp | numFreeVars VV &lt;= length ctx}</span><span class='hs-varid'>ue</span></a> <a class=annot href="#"><span class=annottext>x1:{VV : Language.Stitch.LH.Check.Exp | checkBindings ctx VV
                                        &amp;&amp; numFreeVarsExp VV &lt;= length ctx} -&gt; {t : Language.Stitch.LH.Type.Ty | exprType x1 == t} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &lt;= length ctx
                                         &amp;&amp; numFreeVars v &gt;= 0
                                         &amp;&amp; v == ue}</span><span class='hs-varid'>ue</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>187: </span>      <span class='hs-conid'>UVar</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == elemAt i ctx}</span><span class='hs-varid'>ty</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == elemAt i ctx}</span><span class='hs-conid'>List.elemAt</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a>
<span class=hs-linenum>188: </span>                 <span class='hs-keyword'>in</span> <span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | varNat v == i
                                    &amp;&amp; varTyp v == ty
                                    &amp;&amp; numFreeVarsExp v == i + 1
                                    &amp;&amp; exprType v == ty
                                    &amp;&amp; v == Var ty i}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Var</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == elemAt i ctx
                                  &amp;&amp; v == ty}</span><span class='hs-varid'>ty</span></a> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v &gt;= 0
                     &amp;&amp; v == i}</span><span class='hs-varid'>i</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == elemAt i ctx
                                  &amp;&amp; v == ty}</span><span class='hs-varid'>ty</span></a>
<span class=hs-linenum>189: </span>
<span class=hs-linenum>190: </span>      <span class='hs-conid'>UGlobal</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>(GHC.Maybe.Maybe Language.Stitch.LH.Check.TypedExp)</span><span class='hs-varid'>lookupGlobal</span></a> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | len v &gt;= 0
                        &amp;&amp; length v &gt;= 0
                        &amp;&amp; v == name}</span><span class='hs-varid'>name</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Globals | v == globals}</span><span class='hs-varid'>globals</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>191: </span>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypedExp</span> <span class='hs-varid'>e</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | checkBindings [] v
                                    &amp;&amp; numFreeVarsExp v &lt;= length []
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a> <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>()</span><span class='hs-varid'>aClosedExpIsValidInAnyContext</span></a> <a class=annot href="#"><span class=annottext>{VV : forall a &lt;p :: a a -&gt; Bool&gt;.
      {v : [a]&lt;\x3 VV -&gt; {VV : a&lt;p x3&gt; | true}&gt; | len v == 0
                                                  &amp;&amp; length v == 0
                                                  &amp;&amp; Set_emp (listElts v)
                                                  &amp;&amp; v == []} | VV == []}</span><span class='hs-conid'>[]</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | checkBindings [] v
                                    &amp;&amp; numFreeVarsExp v &lt;= length []
                                    &amp;&amp; numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | exprType e == v
                                  &amp;&amp; v == t}</span><span class='hs-varid'>t</span></a>
<span class=hs-linenum>192: </span>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.TyError | OutOfScopeGlobal##lqdc##$select v == name
                                        &amp;&amp; v == OutOfScopeGlobal name}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>OutOfScopeGlobal</span> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | len v &gt;= 0
                        &amp;&amp; length v &gt;= 0
                        &amp;&amp; v == name}</span><span class='hs-varid'>name</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>193: </span>
<span class=hs-linenum>194: </span>      <span class='hs-comment'>-- XXX: Using $ here causes liquid haskell to crash</span>
<span class=hs-linenum>195: </span>      <span class='hs-conid'>ULam</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp -&gt; Language.Stitch.LH.Type.Ty -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx
                                    &amp;&amp; head v == ty
                                    &amp;&amp; lqdc##$select v == ctx
                                    &amp;&amp; lqdc##$select v == ty
                                    &amp;&amp; len v == 1 + len ctx
                                    &amp;&amp; length v == 1 + length ctx
                                    &amp;&amp; listElts v == Set_cup (Set_sng ty) (listElts ctx)
                                    &amp;&amp; v == : ty ctx}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == body}</span><span class='hs-varid'>body</span></a> <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-layout'>(</span></a><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>r</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>rty</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | lamBdy v == r
                                    &amp;&amp; lamTyp v == ty
                                    &amp;&amp; numFreeVarsExp v == (if 0 &gt; numFreeVarsExp r - 1 then 0 else numFreeVarsExp r - 1)
                                    &amp;&amp; exprType v == TFun ty (exprType r)
                                    &amp;&amp; v == Lam ty r}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Lam</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == r}</span><span class='hs-varid'>r</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | funResTy v == rty
                                  &amp;&amp; funArgTy v == ty
                                  &amp;&amp; (isFunTy v &lt;=&gt; true)
                                  &amp;&amp; v == TFun ty rty}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>TFun</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == rty}</span><span class='hs-varid'>rty</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>196: </span>
<span class=hs-linenum>197: </span>      <span class='hs-conid'>UApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>198: </span>          <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te2</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty2</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>199: </span>            <span class='hs-conid'>TFun</span> <span class='hs-varid'>farg_ty</span> <span class='hs-varid'>res_ty</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>200: </span>              <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == farg_ty}</span><span class='hs-varid'>farg_ty</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>201: </span>                <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | appArg v == te2
                                    &amp;&amp; appFun v == te1
                                    &amp;&amp; numFreeVarsExp v == (if numFreeVarsExp te1 &gt; numFreeVarsExp te2 then numFreeVarsExp te1 else numFreeVarsExp te2)
                                    &amp;&amp; exprType v == funResTy (exprType te1)
                                    &amp;&amp; v == App te1 te2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>App</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te1}</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te2}</span><span class='hs-varid'>te2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == res_ty}</span><span class='hs-varid'>res_ty</span></a>
<span class=hs-linenum>202: </span>              <span class='hs-keyword'>else</span>
<span class=hs-linenum>203: </span>                <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>204: </span>                  <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>205: </span>                  <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == farg_ty}</span><span class='hs-varid'>farg_ty</span></a>
<span class=hs-linenum>206: </span>                  <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a>
<span class=hs-linenum>207: </span>                  <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UApp##lqdc##$select v == e2
                                         &amp;&amp; UApp##lqdc##$select v == e1
                                         &amp;&amp; numFreeVars v == (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2)
                                         &amp;&amp; v == UApp e1 e2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UApp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>208: </span>            <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.TyError | NotAFunction##lqdc##$select v == ty1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>NotAFunction</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>209: </span>          <span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>210: </span>
<span class=hs-linenum>211: </span>      <span class='hs-conid'>ULet</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>212: </span>        <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | tail v == ctx
                                    &amp;&amp; head v == ty1
                                    &amp;&amp; lqdc##$select v == ctx
                                    &amp;&amp; lqdc##$select v == ty1
                                    &amp;&amp; len v == 1 + len ctx
                                    &amp;&amp; length v == 1 + length ctx
                                    &amp;&amp; listElts v == Set_cup (Set_sng ty1) (listElts ctx)
                                    &amp;&amp; v == : ty1 ctx}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a><span class='hs-conop'>:</span><a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te2</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty2</span></a> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>213: </span>          <span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | letBdy v == te2
                                    &amp;&amp; letExp v == te1
                                    &amp;&amp; numFreeVarsExp v == (if numFreeVarsExp te1 &gt; (if 0 &gt; numFreeVarsExp te2 - 1 then 0 else numFreeVarsExp te2 - 1) then numFreeVarsExp te1 else (if 0 &gt; numFreeVarsExp te2 - 1 then 0 else numFreeVarsExp te2 - 1))
                                    &amp;&amp; exprType v == exprType te2
                                    &amp;&amp; v == Let te1 te2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Let</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te1}</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te2}</span><span class='hs-varid'>te2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a>
<span class=hs-linenum>214: </span>        <span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>215: </span>
<span class=hs-linenum>216: </span>      <span class='hs-conid'>UArith</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>217: </span>        <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te2</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty2</span></a> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>218: </span>          <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>219: </span>            <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>220: </span>              <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | ariRhs v == te2
                                    &amp;&amp; ariOp v == op
                                    &amp;&amp; ariLhs v == te1
                                    &amp;&amp; numFreeVarsExp v == (if numFreeVarsExp te1 &gt; numFreeVarsExp te2 then numFreeVarsExp te1 else numFreeVarsExp te2)
                                    &amp;&amp; exprType v == arithType op
                                    &amp;&amp; v == Arith te1 op te2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Arith</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te1}</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te2}</span><span class='hs-varid'>te2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == arithType op}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>arithType</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>221: </span>            <span class='hs-keyword'>else</span>
<span class=hs-linenum>222: </span>              <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>223: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>224: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a>
<span class=hs-linenum>225: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a>
<span class=hs-linenum>226: </span>                <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UArith##lqdc##$select v == e2
                                         &amp;&amp; UArith##lqdc##$select v == op
                                         &amp;&amp; UArith##lqdc##$select v == e1
                                         &amp;&amp; numFreeVars v == (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2)
                                         &amp;&amp; v == UArith e1 op e2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UArith</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>227: </span>          <span class='hs-keyword'>else</span>
<span class=hs-linenum>228: </span>            <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>229: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>230: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a>
<span class=hs-linenum>231: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a>
<span class=hs-linenum>232: </span>              <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UArith##lqdc##$select v == e2
                                         &amp;&amp; UArith##lqdc##$select v == op
                                         &amp;&amp; UArith##lqdc##$select v == e1
                                         &amp;&amp; numFreeVars v == (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2)
                                         &amp;&amp; v == UArith e1 op e2}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UArith</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Op.ArithOp | arithType v == TBool
                                     || arithType v == TInt
                                     &amp;&amp; v == op}</span><span class='hs-varid'>op</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>233: </span>        <span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>234: </span>
<span class=hs-linenum>235: </span>      <span class='hs-conid'>UCond</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>236: </span>        <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te2</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty2</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te3</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty3</span></a> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>237: </span>          <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TBool}</span><span class='hs-conid'>TBool</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>238: </span>            <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty3}</span><span class='hs-varid'>ty3</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>239: </span>              <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | conAnt v == te3
                                    &amp;&amp; conCon v == te2
                                    &amp;&amp; conPrc v == te1
                                    &amp;&amp; numFreeVarsExp v == (if (if numFreeVarsExp te1 &gt; numFreeVarsExp te2 then numFreeVarsExp te1 else numFreeVarsExp te2) &gt; numFreeVarsExp te3 then (if numFreeVarsExp te1 &gt; numFreeVarsExp te2 then numFreeVarsExp te1 else numFreeVarsExp te2) else numFreeVarsExp te3)
                                    &amp;&amp; exprType v == exprType te2
                                    &amp;&amp; v == Cond te1 te2 te3}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Cond</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te1}</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te2}</span><span class='hs-varid'>te2</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te3}</span><span class='hs-varid'>te3</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a>
<span class=hs-linenum>240: </span>            <span class='hs-keyword'>else</span>
<span class=hs-linenum>241: </span>              <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>242: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e3}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>243: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty2}</span><span class='hs-varid'>ty2</span></a>
<span class=hs-linenum>244: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty3}</span><span class='hs-varid'>ty3</span></a>
<span class=hs-linenum>245: </span>                <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UCond##lqdc##$select v == e3
                                         &amp;&amp; UCond##lqdc##$select v == e2
                                         &amp;&amp; UCond##lqdc##$select v == e1
                                         &amp;&amp; numFreeVars v == (if (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2) &gt; numFreeVars e3 then (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2) else numFreeVars e3)
                                         &amp;&amp; v == UCond e1 e2 e3}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UCond</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>246: </span>          <span class='hs-keyword'>else</span>
<span class=hs-linenum>247: </span>            <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>248: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>249: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TBool}</span><span class='hs-conid'>TBool</span></a>
<span class=hs-linenum>250: </span>              <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a>
<span class=hs-linenum>251: </span>              <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UCond##lqdc##$select v == e3
                                         &amp;&amp; UCond##lqdc##$select v == e2
                                         &amp;&amp; UCond##lqdc##$select v == e1
                                         &amp;&amp; numFreeVars v == (if (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2) &gt; numFreeVars e3 then (if numFreeVars e1 &gt; numFreeVars e2 then numFreeVars e1 else numFreeVars e2) else numFreeVars e3)
                                         &amp;&amp; v == UCond e1 e2 e3}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UCond</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e1}</span><span class='hs-varid'>e1</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e2}</span><span class='hs-varid'>e2</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e3}</span><span class='hs-varid'>e3</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>252: </span>        <span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>253: </span>
<span class=hs-linenum>254: </span>      <span class='hs-conid'>UFix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Exp</span><span class='hs-varid'>te1</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty1}</span><span class='hs-varid'>ty1</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>255: </span>          <span class='hs-conid'>TFun</span> <span class='hs-varid'>arg_ty</span> <span class='hs-varid'>res_ty</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>256: </span>            <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == arg_ty}</span><span class='hs-varid'>arg_ty</span></a> <span class='hs-varop'>==</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == res_ty}</span><span class='hs-varid'>res_ty</span></a> <span class='hs-keyword'>then</span>
<span class=hs-linenum>257: </span>              <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | fixFun v == te1
                                    &amp;&amp; numFreeVarsExp v == numFreeVarsExp te1
                                    &amp;&amp; exprType v == funResTy (exprType te1)
                                    &amp;&amp; v == Fix te1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>Fix</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | numFreeVarsExp v &gt;= 0
                                    &amp;&amp; v == te1}</span><span class='hs-varid'>te1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == res_ty}</span><span class='hs-varid'>res_ty</span></a>
<span class=hs-linenum>258: </span>            <span class='hs-keyword'>else</span>
<span class=hs-linenum>259: </span>              <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <span class='hs-varop'>$</span> <span class='hs-conid'>TypeMismatch</span>
<span class=hs-linenum>260: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>261: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | funResTy v == arg_ty
                                  &amp;&amp; funArgTy v == arg_ty
                                  &amp;&amp; (isFunTy v &lt;=&gt; true)
                                  &amp;&amp; v == TFun arg_ty arg_ty}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>TFun</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == arg_ty}</span><span class='hs-varid'>arg_ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == arg_ty}</span><span class='hs-varid'>arg_ty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>262: </span>                <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | funResTy v == res_ty
                                  &amp;&amp; funArgTy v == arg_ty
                                  &amp;&amp; (isFunTy v &lt;=&gt; true)
                                  &amp;&amp; v == TFun arg_ty res_ty}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>TFun</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == arg_ty}</span><span class='hs-varid'>arg_ty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == res_ty}</span><span class='hs-varid'>res_ty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>263: </span>                <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | UFix##lqdc##$select v == e
                                         &amp;&amp; numFreeVars v == numFreeVars e
                                         &amp;&amp; v == UFix e}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>UFix</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>264: </span>          <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV : forall a b .
      x1:a -&gt; {v : (Data.Either.Either a b) | v == Left x1} | VV == Left}</span><span class='hs-conid'>Left</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.TyError | NotAFunction##lqdc##$select v == ty1}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>NotAFunction</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | lqdc##$select v == e}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>ScopedUExp</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == length ctx
                     &amp;&amp; v &gt;= 0}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>List.length</span> <a class=annot href="#"><span class=annottext>{v : [Language.Stitch.LH.Type.Ty] | len v &gt;= 0
                                    &amp;&amp; length v &gt;= 0
                                    &amp;&amp; v == ctx}</span><span class='hs-varid'>ctx</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.UExp | numFreeVars v &gt;= 0
                                         &amp;&amp; v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<span class=hs-linenum>265: </span>        <span class='hs-layout'>)</span>
<span class=hs-linenum>266: </span>
<span class=hs-linenum>267: </span>      <span class='hs-conid'>UIntE</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | intVal v == i
                                    &amp;&amp; numFreeVarsExp v == 0
                                    &amp;&amp; exprType v == TInt
                                    &amp;&amp; v == IntE i}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>IntE</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Int | v == i}</span><span class='hs-varid'>i</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TInt}</span><span class='hs-conid'>TInt</span></a>
<span class=hs-linenum>268: </span>
<span class=hs-linenum>269: </span>      <span class='hs-conid'>UBoolE</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x1:{v : Language.Stitch.LH.Check.Exp | checkBindings ctx v
                                       &amp;&amp; numFreeVarsExp v &lt;= length ctx} -&gt; {v : Language.Stitch.LH.Type.Ty | exprType x1 == v} -&gt; (Data.Either.Either Language.Stitch.LH.Check.TyError a)</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.Exp | bolVal v == b
                                    &amp;&amp; numFreeVarsExp v == 0
                                    &amp;&amp; exprType v == TBool
                                    &amp;&amp; v == BoolE b}</span><span class='hs-layout'>(</span></a><span class='hs-conid'>BoolE</span> <a class=annot href="#"><span class=annottext>{v : GHC.Types.Bool | v == b}</span><span class='hs-varid'>b</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | (isFunTy v &lt;=&gt; false)
                                  &amp;&amp; v == TBool}</span><span class='hs-conid'>TBool</span></a>
<span class=hs-linenum>270: </span>
<span class=hs-linenum>271: </span><span class='hs-comment'>-- XXX REMOVE THIS IF NOT NEEDED</span>
<span class=hs-linenum>272: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>273: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>TyError</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>274: </span>    <span class='hs-conid'>OutOfScopeGlobal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyError</span>
<span class=hs-linenum>275: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NotAFunction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyError</span>
<span class=hs-linenum>276: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypeMismatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyError</span>
<span class=hs-linenum>277: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>278: </span>
<span class=hs-linenum>279: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>TyError</span>
<span class=hs-linenum>280: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OutOfScopeGlobal</span> <span class='hs-conid'>String</span>
<span class=hs-linenum>281: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NotAFunction</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-conid'>Ty</span>
<span class=hs-linenum>282: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypeMismatch</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-conid'>Ty</span> <span class='hs-conid'>Ty</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-comment'>-- expression expected_type actual_type context</span>
<span class=hs-linenum>283: </span>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Show</span>
<span class=hs-linenum>284: </span>
<span class=hs-linenum>285: </span><span class='hs-keyword'>instance</span> <a class=annot href="#"><span class=annottext>(Text.PrettyPrint.ANSI.Leijen.Internal.Pretty Language.Stitch.LH.Check.TyError)</span><span class='hs-conid'>Pretty</span></a> <span class='hs-conid'>TyError</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>286: </span>  <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.TyError -&gt; Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>pretty</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<span class=hs-linenum>287: </span>    <span class='hs-conid'>OutOfScopeGlobal</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>288: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"Global variable not in scope:"</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>squotes</span></a> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-layout'>(</span></a><span class='hs-varid'>text</span> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | len v &gt;= 0
                        &amp;&amp; length v &gt;= 0
                        &amp;&amp; v == name}</span><span class='hs-varid'>name</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>289: </span>    <span class='hs-conid'>NotAFunction</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>290: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"Expected a function instead of"</span></a> <span class='hs-varop'>&lt;+&gt;</span>
<span class=hs-linenum>291: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>squotes</span></a> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-layout'>(</span></a><span class='hs-varid'>prettyTypedExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | v == e}</span><span class='hs-varid'>e</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>292: </span>    <span class='hs-conid'>TypeMismatch</span> <span class='hs-varid'>e</span> <span class='hs-varid'>expected</span> <span class='hs-varid'>actual</span> <span class='hs-varid'>ctx</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>293: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"Found"</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>squotes</span></a> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-layout'>(</span></a><span class='hs-varid'>prettyTypedExp</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | v == e}</span><span class='hs-varid'>e</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == expected}</span><span class='hs-varid'>expected</span></a><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$$&gt;</span>
<span class=hs-linenum>294: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"but expected type"</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>squotes</span></a> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-layout'>(</span></a><span class='hs-varid'>pretty</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == actual}</span><span class='hs-varid'>actual</span></a><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$$&gt;</span>
<span class=hs-linenum>295: </span>      <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>inTheExpression</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | v == ctx}</span><span class='hs-varid'>ctx</span></a>
<span class=hs-linenum>296: </span>
<span class=hs-linenum>297: </span><span class='hs-definition'>prettyTypedExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Doc</span>
<span class=hs-linenum>298: </span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp -&gt; Language.Stitch.LH.Type.Ty -&gt; Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-definition'>prettyTypedExp</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-varid'>e</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Type.Ty</span><span class='hs-varid'>ty</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>pretty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | v == e}</span><span class='hs-varid'>e</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>":"</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>pretty</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a>
<span class=hs-linenum>299: </span>
<span class=hs-linenum>300: </span><span class='hs-definition'>inTheExpression</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScopedUExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Doc</span>
<span class=hs-linenum>301: </span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp -&gt; Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-definition'>inTheExpression</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Unchecked.ScopedUExp</span><span class='hs-varid'>e</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>text</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-str'>"in the expression"</span></a> <span class='hs-varop'>&lt;+&gt;</span> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-varid'>squotes</span></a> <a class=annot href="#"><span class=annottext>Text.PrettyPrint.ANSI.Leijen.Internal.Doc</span><span class='hs-layout'>(</span></a><span class='hs-varid'>pretty</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Unchecked.ScopedUExp | v == e}</span><span class='hs-varid'>e</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>302: </span>
<span class=hs-linenum>303: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>304: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TypedExp</span> <span class='hs-layout'>{</span> <span class='hs-varid'>texp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>WellTypedExp</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>tty</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span> <span class='hs-varid'>t</span><span class='hs-conop'>:</span><span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>exprType</span> <span class='hs-varid'>texp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span>
<span class=hs-linenum>305: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>306: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TypedExp</span> <span class='hs-layout'>{</span> <span class='hs-varid'>texp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>tty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ty</span> <span class='hs-layout'>}</span>
<span class=hs-linenum>307: </span>
<span class=hs-linenum>308: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>typedExpType</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>309: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>typedExpType</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>e</span><span class='hs-conop'>:</span><span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span> <span class='hs-varid'>t</span><span class='hs-conop'>:</span><span class='hs-conid'>Ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>exprType</span> <span class='hs-layout'>(</span><span class='hs-varid'>texp</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span> <span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>310: </span><span class='hs-definition'>typedExpType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ty</span>
<span class=hs-linenum>311: </span><a class=annot href="#"><span class=annottext>x1:Language.Stitch.LH.Check.TypedExp -&gt; {VV : Language.Stitch.LH.Type.Ty | VV == typedExpType x1
                                                                           &amp;&amp; exprType (texp x1) == VV}</span><span class='hs-definition'>typedExpType</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>TypedExp</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Type.Ty | v == ty}</span><span class='hs-varid'>ty</span></a>
<span class=hs-linenum>312: </span>
<span class=hs-linenum>313: </span><span class='hs-comment'>-- | The global variable environment maps variables to</span>
<span class=hs-linenum>314: </span><span class='hs-comment'>-- expressions</span>
<span class=hs-linenum>315: </span><span class='hs-comment'>-- YYY: Using newtype causes LH to crash.</span>
<span class=hs-linenum>316: </span><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Globals</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Globals</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>String</span> <span class='hs-conid'>TypedExp</span><span class='hs-layout'>)</span>
<span class=hs-linenum>317: </span>
<span class=hs-linenum>318: </span><span class='hs-comment'>-- | An empty global variable environment</span>
<span class=hs-linenum>319: </span><span class='hs-definition'>emptyGlobals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Globals</span>
<span class=hs-linenum>320: </span><a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.Globals</span><span class='hs-definition'>emptyGlobals</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Globals</span> <span class='hs-conid'>Map.empty</span>
<span class=hs-linenum>321: </span>
<span class=hs-linenum>322: </span><span class='hs-comment'>-- | Extend a 'Globals' with a new binding</span>
<span class=hs-linenum>323: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>extendGlobals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Globals</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Globals</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>324: </span><span class='hs-definition'>extendGlobals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TypedExp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Globals</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Globals</span>
<span class=hs-linenum>325: </span><a class=annot href="#"><span class=annottext>[GHC.Types.Char] -&gt; Language.Stitch.LH.Check.TypedExp -&gt; Language.Stitch.LH.Check.Globals -&gt; Language.Stitch.LH.Check.Globals</span><span class='hs-definition'>extendGlobals</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-varid'>var</span></a> <a class=annot href="#"><span class=annottext>Language.Stitch.LH.Check.TypedExp</span><span class='hs-varid'>e</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Globals</span> <span class='hs-varid'>globals</span><span class='hs-layout'>)</span>
<span class=hs-linenum>326: </span>  <span class='hs-comment'>-- YYY: Using $ causes LH to fail here</span>
<span class=hs-linenum>327: </span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(Data.Map.Internal.Map [GHC.Types.Char] Language.Stitch.LH.Check.TypedExp) -&gt; {v : Language.Stitch.LH.Check.Globals | Globals##lqdc##$select v == x1
                                                                                                                         &amp;&amp; v == Globals x1}</span><span class='hs-conid'>Globals</span></a> <span class='hs-varop'>$</span> <a class=annot href="#"><span class=annottext>(Data.Map.Internal.Map [GHC.Types.Char] Language.Stitch.LH.Check.TypedExp)</span><span class='hs-conid'>Map.insert</span></a> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | len v &gt;= 0
                        &amp;&amp; length v &gt;= 0
                        &amp;&amp; v == var}</span><span class='hs-varid'>var</span></a> <a class=annot href="#"><span class=annottext>{v : Language.Stitch.LH.Check.TypedExp | v == e}</span><span class='hs-varid'>e</span></a> <span class='hs-varid'>globals</span>
<span class=hs-linenum>328: </span>
<span class=hs-linenum>329: </span><span class='hs-comment'>-- | Lookup a global variable.</span>
<span class=hs-linenum>330: </span><span class='hs-definition'>lookupGlobal</span>
<span class=hs-linenum>331: </span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Globals</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TypedExp</span>
<span class=hs-linenum>332: </span><a class=annot href="#"><span class=annottext>[GHC.Types.Char] -&gt; Language.Stitch.LH.Check.Globals -&gt; (GHC.Maybe.Maybe Language.Stitch.LH.Check.TypedExp)</span><span class='hs-definition'>lookupGlobal</span></a> <a class=annot href="#"><span class=annottext>[GHC.Types.Char]</span><span class='hs-varid'>var</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Globals</span> <span class='hs-varid'>globals</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map.lookup</span> <a class=annot href="#"><span class=annottext>{v : [GHC.Types.Char] | len v &gt;= 0
                        &amp;&amp; length v &gt;= 0
                        &amp;&amp; v == var}</span><span class='hs-varid'>var</span></a> <span class='hs-varid'>globals</span>
</pre>
</body>
</html>